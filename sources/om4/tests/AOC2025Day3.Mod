MODULE  AOC2025Day3;
  IMPORT Texts, Oberon, L := SystemLog;

  TYPE ProcessProc = PROCEDURE(bank: ARRAY OF BYTE; n, nd: INTEGER);

  VAR W: Texts.Writer;
    sum: LONGINT;

  PROCEDURE parse(process: ProcessProc; VAR bank: ARRAY OF BYTE; nd: INTEGER);
    VAR S!: Texts.Scanner; ch: CHAR; n: INTEGER;
  BEGIN 
    Texts.OpenScanner(S, Oberon.Par.text, Oberon.Par.pos);
    Texts.Read(S, ch); n := 0;
    WHILE (ch >= "0") & (ch <= "9") OR (ch = Texts.CR) DO
      IF ch = Texts.CR THEN process(bank, n, nd); n := 0
      ELSE bank[n] := ORD(ch) - ORD("0"); INC(n)
      END;
      Texts.Read(S, ch)
    END
  END parse;

  PROCEDURE doPart(bank: ARRAY OF BYTE; n, nd: INTEGER);
    VAR dp, d, i: INTEGER; max: BYTE; jolt: LONGINT;
  BEGIN
    IF n > 0 THEN jolt := 0; dp := 0;
      FOR d := nd TO 1 BY -1 DO max := 0;
        FOR i := dp TO n - d DO IF bank[i] > max THEN dp := i; max := bank[i] END END;
        jolt := jolt*10; INC(jolt, bank[dp]); INC(dp)
      END;
      INC(sum, jolt)
    END
  END doPart;

  PROCEDURE part1*;
    VAR bank: ARRAY 200 OF BYTE;
  BEGIN
    sum := 0; parse(doPart, bank, 2);
    Texts.WriteString(W, "Partie 1: sum = "); Texts.WriteInt(W, sum, 1); Texts.WriteLn(W);
    Texts.Append(Oberon.Log, W.buf)
  END part1;

  PROCEDURE part2*;
    VAR bank: ARRAY 200 OF BYTE;
  BEGIN
    sum := 0; parse(doPart, bank, 12);
    Texts.WriteString(W, "Partie 2: sum = "); Texts.WriteInt(W, sum, 1); Texts.WriteLn(W);
    Texts.Append(Oberon.Log, W.buf)
  END part2;

BEGIN Texts.OpenWriter(W)
END AOC2025Day3.

OM4P.Compile AOC2025Day3.Mod/s~
System.Free AOC2025Day3 ~

Test data
Partie 1: sum = 357
AOC2025Day3.part1
Partie 2: sum = 3121910778619
AOC2025Day3.part2
987654321111111
811111111111119
234234234234278
818181911112111
~

Partie 1: sum = 16927
AOC2025Day3.part1
Partie 2: sum = 167384358365132
AOC2025Day3.part2
5336553644444345344544134246423443634474453456455433543434354444344554344336446734443434424442135474
2231552222211222122232222222153222143972321313222122221132199121111212232232222223322324232211141222
2772224762425225322223343411225274238762252256511426224222252321273712444222223222322212222372514722
2222332122223225222222231122322211162222222122222223222222112222222221222221122222211222221323211121
2442432212422332232212684452222313252425265641254324242452246232226535522434643524124524537424423362
2222233422111423621122222212311251411422222223222912458231222425211121231623223282223222522223222122
6222223242223652228324218422222362221764545245524242232623222297125251246222225724122121211122224222
4232224233342412225323232213216232342313322232223122122235533321125233534232433231314523232332322221
2122322222214334122221225332224135442322222222212222422222323226222122212232212224221122213432222122
2424223122212362222224552241443214224422422432222223843433512122232228212222124434222582122223222222
2432223333332221313232223422213342233315232323222331512443326233254223233333233636213322362222256222
7122126632562515224125225362667124227322322242224271222621716242222212522123121227432224225952272253
2222212212242122222232222221221722123232232212122212232222221222322221222233321212222421322222222212
2221221422211222212322322121412222222222122222222224241219222222222222221222112223222322212632122222
5534445456247653656757666664627455835542585748445743654764144452444387554884458915245555558444643884
9512534434375364134535574254437735656452833258371533854544254231533455464457764721474675412285253244
1222132235322123232352222234221222222232222343133534223311734323361424423343223254323262234232412232
3335393323363345233744353533723247497385344635743444543334136356167734741354933353336333373325323363
6246535473632347143443572543225451752532247667623444533348753324456165153345524525229354246267552136
3833423335226442242752254233438221626337276763855254394314383424391322976834897938339225342384484139
6566326325524467263334162556535653665353335233353664454455232456455242645465666454544553386416347535
4324186432313312134243423843486524124326333333433323213351442733425223432233323283333443833433213244
5331244255455613356533321313557625245322332438123334257346465238275342452343137252243454142412433412
3636221535225324121161754452223333432625253335323942128583211532241273421552322635332525352358633395
1434424644342423614412464334249543241223622174434228241426244444222346244218262266224444458241414316
4429643565232425335455432594493435463576463335543244433365262284343643434433375323444336235434367853
3333348355135625533433434354535533552333333254363623545454353346333355553533355333333335545375745333
9413365353252234324342233243221133223434433413483224344244114522232211446173522421253531512217333231
5355634553564545344643644465443354144553453444453345354624334535434345444544445634341555444557443455
1242224257112316335224222232243261832293222423332732225242234225232332382414535443333422422333222331
2221332115546245222243332562793281316628425355453522312122442428632218343424314238511422857223243245
3212222212222312212222224211242222112322232222222222151223211222252122524222222276222221212232212323
3222225222232221112232232222223342231221221223342212223134233222222332222315332222322212341222124232
2212334243133632233222232132122547323243313433286331313223512422233234232332223244323223327523226335
2122223432122231232152222122224122443212122222422222242253222212222222321225323232232211222223231232
2244622222232212222242224212142423222123323122422412232423323324432241321323364142423222223233411225
6222423434424455444354144148342344374233244314223355434444343114251222313122428334422422443428433223
3325133224211221234125132133262122322121125262222122273311632232111232122322423232324421233162432232
5637666677943457253454738838787924579339159539896464934479569377944395958548836349747363665486449333
2335224252512222332222512422323442312222432222121131222224422433531222232224321331123352233321361521
2132128512324422422435822243221724432283234851222824264222292232222264242333343231122258221452223252
5526862426624475574252856573796356754365634425536464563546663465229665555553346633385746235344462425
8222263129412219224258536469522726265398956353283431222762985937532863646362328356224222642445222111
6236221122224222122213221222126622145225272222226222121122422221631122222232223222223422231124224414
2122332124322232232222222221226112257422632232423232221216222222244232142443322321722212124222233223
2233222222211228282214322222227212222222212221244224212263712213342222232522142122415222232322283232
4633454261634464152435443124252423444372351444625334424633335426645322323226634643354242253135326245
5678982394685564845994548657644669444558464947748578335844998769476397766345944646499828444464863436
2432353123332533122523225323134434143222322323321442323223441143535334332344233333333433333332322432
5445354524444553433774155342432544354435484255854333514533562923334444543244335434343346344134333476
2321344223851236236322443422436332443414234464224817412442644242424222244632232542234532335324242334
2222223122523215222222222221362222122132322342254232325222125131222262231223222123212122223224111262
2533333663433435543462553544333464333233532345326332253233633453447435342242415433343655634335352266
2233432331345835321313332433222633566311333365337323237332444564333332432423334215232332224322433634
7224252465341134353224671212245243514323345312427223442242132255742541224325533433326331221432243212
3222232163134332123233342223322233383262222333123231232332243323533223234233334332422433334334232432
2154534332343514341333463325334645234573643247242544225243633435524224433432656273633324637523322143
5145513444512134242431353321552131334342142341531323351541353545355124411435413544254442343313346789
4634443444547564454535457334435334463553456444843344524344832442855447443844354754345448415474845343
1323131421243626533322324315621261232129463912228668231154214444517427321284416448333612262343332527
2322222322222157522321312232232271322222222234272246222221331322332413225221222322237212222213452222
3232522214322232222232324231232431722322222342342241443122222323322322322243222322231243123231233323
4345222132632322234242343613632223331222223328383242222632233133522435222633222221326123243621122436
7433257484523366444617242684443254482342134233331526534514323426271284776345312453344186353431639431
9214342212223723243326422342652224164271452123412422532623224322341231223212235212223221222634434435
3564546123223222531252252522121332524612412253222222232232224424422151215212522221342242211424222134
7453433853366853658525854223338553667352333585343344315442274459554343694755458365524564583734397265
3553515453526335821442323544154332433425255115455219523343223225655453383221253393442333635322232355
2323232322233122221224222111322222332322211222332221333232222323333222322314223222323112242233222333
4333331335432323737332423343343224333233273132433133323432342423833234352623142313332333343323233224
6322223221223223222222222222223122242122342212222222222212722122832322213212424331222212223222262214
1423443416323252424932416443425571522534322276431723266212255282578276186352235252224258522515621452
3573553334519433332763744335535636343362286677837432334354435463765235352664356363263356336532237237
6113635328352623431322232828262444746448414873243353662187252466123634264535262243834442323326254553
5486574862454574344447734335813467864444275314764454438848385373449844532533797368534836815543674567
5624241446642762525428236843434782152225343232123686742575651477545574442472256643243624145433545252
3322332325512323242112542327331233335355332323833223343232333363332231332222233233343143332633252212
2221221221211222332725232512221242213332122265225221224432263232212242232272272155254347725123524212
3435623433452254355334236443122433433774353441243343723523344354357333347323334346333324335331342396
3372133423342432543423233333332934423433223322263331333222323343333432332333622332433323624243323443
5153522485233336423557422642523125555232424314216363223931474143556314435424333333134344543353634724
4431333322223322122322133242332237223216217233262123423236336221233331323212332432321233212312233211
4273766364364364655646636764456566664486572444347935446768668666555466465466324635358758666626644765
8353428675276531424242352242842454528545321623173972565527756985264327342746265422243376731272443245
3244442364341425252371262243432122221422624233364335216334132224653452124253421225252422244133252363
3322112212722221225221222422123221111242264212622222542722232237122221222142222113322292222221222221
4224443345445736233345344453424443444443434454444341421433354334644445343543441444243378343524415483
5543555445444342555344353455333452553253432354364435334423551355454124334343433443463433245555334463
9459632664652175793511423543438453733546775296353233368372323633444893214375436376751336365296442933
6684956778789897766976966779578748656676877675996987448628697786699977485795996797799499599879366597
2332333353364332643333335332623333523332233332535523333313363222242362322333336443523335433314334333
2212333262343232222142224653123133133332336442332233223323323233322213231322233123222433632232533222
4244332443324312745322622221314464334132126237435332222214231553234233212232123234343435435224722323
5235454144443534343235442423344235444323432442454454454443444332233433544244633434554426345333434334
6162321135333124313242362623262352325228242354422226233323133113632326225333223332592222315163266232
6443453543334546545634524843553334424254145545425564345335534451472437755444765635244223453336533595
5235553432323222434353234554332212315224155332242483222543221135253533223242437333533242254334258542
5212231224312712512222124253421112212441424122122146222221262225232622112264322222223244124253233541
1561232212221221221721221327324642414342517662211357223356477323132351242122563322243213412522622512
2323969243372322938332526337221165933235227131687296213252662531524437527284729253511334229133235436
2342232222222146125316153626218245622433222236542233625353314232263222244513524321313222232322232823
1342334332323323434451123323233433233121144331322342315342522731333332122233371323326124423313224253
1223122222323222222344332322222512222223222222222222132222224224212333422331223234323233222123132224
5255323322222131232339223153323322221222223312325332225522333422333322213322236431421333333223232133
5774662565434662544452426446275286662563474232352644526648674554413544854255424662535673643565765663
4433545546337355545455654557555465733569744955683676558545454545549565344855554594454718565459546445
4336523445443593523464455244445738633353444454456234434533244534443445432312472334346234535433544553
2833324214522451212343233441642223232222313383222229514133245413412942232431434236244222332252246122
4457462445545666854155774823256874546455554516646457186727856445223576676267358538826287614348132732
1233223122223133221322221321221212132222211242122224222211213322323222232222212423222222212226222222
6424433252446633434461322433222433342133334476234523452345342132423436133236243232345434434933333454
3474443452446431344474444436443244223533242344244444443443444464344344342343463659435732344434447244
6224463414754576665425424544934552736357254143355333542564547555445335623322323693434433345453357453
4232422525233332345352243234256237325354742355315935122265254245275534322646144325262335634355243233
3421222232322235232225233242222235322451222222222221622222522221221352222222222123242113222322222232
4525354634252345424334662656165234433352556232316562562544345223343812143422473434632433632344232266
3333331462244343343343213342323233333333643333332223333211133433333144333333333433133334333342332323
3351444423337331433253625345533335333254522543375435453135433473442353233645534333453334333332444532
2231261133222247347224721312733322532223222222282233417132522424432343359324664322223233343212663331
2793725437323644653254435233353433425345335223554345423475334233523435623354323451622672343424346931
7561722372945437489223787771362729622836228356343333843917723462433378833638238394835351887379738939
3222262286724212792226485212314122752232242225327234734322322232136333264522231222715142731823223334
3312345432264325394217133433324213343222322445241241453125221432222132122351223212326435257232323222
2732332335423425242354262231123131929233152335311331233363573112323732123212232222413127381333814123
2336322233223332223443322371252223324223222333342222224312323331722242244243222323321224222223222412
6311751123743582558757672228658342222515356174644587274476221364232421756887783677887812824778636839
1421111442223124421441434411211222441313144121242441414413224322113124434423331124233143242113356789
1445245523424245334544553433315432342123525425435244256533533513434242225343254533524555456233224432
2123222311224132122212222221122231223222342222231322122222222212221242322232212231231122211322221222
8883985796555675426659999936373533987958952445479449677795598777858999733957599799545656875568335547
2112122623212322223331212212222226422222214172122523122642224222222242323421234123532222223321121249
8458686378754755587576576589759659886465778678778374653583587623886477867777584584684886675656756958
3223322133332333212231223224333221222251232331121212423134622122122223232332122254222333333131312212
4141542644444245445244432265424447445234422343354234444324683233258244684445364225538464926432442143
3228223453425236412466264333633533272367226881356944372356332332444323236327623433745523344538923323
2333313332332212222722222331221225143333133313232223322232223124213232122232243443422434321313432141
7342923454835333333223225633427423444122333272533453323472533585545331433323533728542233363447333336
2212232212121242233225222422222222421432421222423132142222221122221422322212533222522222222212122224
4622234322422124213121323333233233312174431342133231211242324323232421221233234223333342323332311333
2321232211222222212223222121222126123122123222212222222713222122122221212122212222222221132212241222
3332321222521221232324223413226223332213645322222222222222421332164412132122523232221121332532143222
3232328233423212123332333323432733423313433321231333532413232322314323311222334243233245323225433213
4736875381141534423854564745441756442425372355252315442444344425221525324555345527441547525234274422
3332355333332355333353443333352353433342413333323533333314333332334223333244333123333353433433313333
3223242252222112251255231122331222222112452424221221232312115222235222221212222222275212222212552125
4513232513422226322223622426222412252242432315264615452122324244441362543232243243543143415432123444
1242225222444327221222225524222322244123112632325122264221462222221363222229224423242222424562622252
4333531223234423332413333423463243434363235234334453422343231433233334441412433333415334333258333313
4448433512666323424233523547255464334345321633343458215355344466552336444317333333127434753334332333
7345354336432434223224313354453545434252434283344552223423328443342344455612425453344412312224425274
4221122232333322224122322232521124223221222222221222231236242222421222222231311222343292223323322252
2213212223323321232243221332134233321424332222122212232135222231932224221222225112221242321433222132
4253724445422452428224374464243663253445354661415412544424627465526524452334354534241532245612415423
2122214225223214222222443211212422217412125212525121224425346421223352221224213232342224442322224311
3322234333332321263333333933333333733323432553533333333323633351333333523661333331134332333323433233
3222721312222123412223432171222123223263322221332122232313322222123232312432223221129222121122132221
2522642322122524142231231422542242211122346222242324322322334423414322223212522326521335224321212524
7553353156356515584343226346544565558264254226827567475462364576544228552423461321682755526346356484
4435442344132654633442424443432364554344232245252233532473441344443343345431445153243434444437364644
2222226455121242221225227222221122222241634222141233324322722222722232167222122222332125321322222263
7254834412454523224344289334292442522324374251784354254324565948424741878316233472532363245233452233
2214324482133242143233644434321222114444322184532346242314337742123222342425145131344125232313323453
3152212772331422223213222322221321122326312534326222232125322233225312722212222222324236322572953482
2222425315422422242133422233622424323442461342142434221224122223214222432231242332444233223513232422
2211227222222216222222321212223332212221252231231222222222312222222222312213222222123322113222324122
7532455271643676366357643744618286355632783547834275943358643936546449636336433675848332749465865965
2187346795965575617164778898445362464673262395435955562262826331265972347286947324355426636242496642
2322422242221222222212122122232221222221322432322121212222212232231111232322223222222223222323212212
2233122126528772261371837532333324342772239253233622326643713535363522234117223231374315133572652228
5665546456565433655524616154465355565856519531236454485345645653613435834436545555555725665566655465
2222222222122221222221222222122132122222213212223222222221213222332222122233212212122221322122222122
6454665342425535613452653343646233543337326322643654552363523466535954553423457655246663542346683234
2324333343126133232362221432343432363433323323322333533643313222335333323236333533343543333333332235
1324223213232113321221222222223231312433321122512231422123241222223122223222222122322332123223422222
3475645674676475778545676874855755774336685398586375377655764858454755766636767775677477876667676336
3222412222512322112313232322222584222231781222322222251222222442222121485233112322224334222425121242
3223223224542333335232322732357332331242263392763752451262272231351236222223132134562126334742427322
2542252222231522856625152142232223221212521122419222122325112212122222122222422222222217254223222262
4547537513254245344346234124455433474433372433242538444452445755331312425442434554315527443241422325
4445335445556244762835243646283335359378432443745564643552444353345434587147443333334365255367356454
3234643355933222333323333133333244252142323323332333124334323323333312634333353353333123343233225532
5528234277872276744672842355726235847489732777137777824367399396996478652456491298349416453921854337
1223322542132222223323132222122222233412132322334221223243213223223112233332322241421223211222331323
2322225222222122235232112221242222422127222222431224222232123541254252222257431244122152321712322221
7657456331563216562634654224322452566143465272217643337113211677757511536441571276777725366617123589
3812813224822442932432242733222322142425241922249236226112221247222242273323313223232594223222253279
3857567657498655647688677456315675545174335342575756956565566645779787645754698334355685458746426456
2746424442421333364244543322434374364434624542878275422541337522434764724222454754733222343251453452
4243222222223122232514242122223343244444243322434432414232624363241441311434322223422422442122224225
5422323334251453444454343442444434444433444444424434464355445636343364223233547334243565463223543353
4333444243432413544332351334434323124522324325342433143343154344343322334233342223224443354424444424
2234442134457543366242252433532452522242824343224231342327717322434444724512416452223223754324715727
8332268533222112243243252346613483242232224132353122842733522684235222222571235232232253127222262222
2321231223322333213363333272323232323332416222733212233222332212221222233243243231223322313323233413
3423422124542223133242222222221632213224222222112422643222332422322541212451123232222233123222222227
2323332222215222232223227232222342323223221423113232232232322732221322242222312213223323112322223222
2245715272513133322434335464322323333232754364273424241423222463424522223533112411739542122823433443
8294484637572964647574463598342154393863775265338396542534532354545669212856524784298281514656455646
1136232521161566663356511554543612421615256265466164316421666416414542446556624131632223534212255789
8253243324523333532224546353152554242525224253255824125264455332262523225422354333245722624625223832
~
